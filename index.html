<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>è”šæ¥å¯æœŸ - ç›´æ¥æ˜¾ç¤ºç‰ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { width:100vw; height:100vh; overflow:hidden; background:#000; position:fixed; top:0; left:0; }
        
        /* åŠ è½½ç•Œé¢ */
        .loading {
            position:fixed; top:0; left:0; width:100%; height:100%;
            background:#000; color:#fff;
            display:flex; flex-direction:column;
            justify-content:center; align-items:center;
            z-index:100; font-size:16px;
        }
        
        .spinner {
            width:40px; height:40px; margin-bottom:20px;
            border:3px solid rgba(255,255,255,0.2);
            border-top-color:#fff; border-radius:50%;
            animation:spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform:rotate(360deg); } }
        
        /* å›¾ç‰‡å®¹å™¨ */
        .image-container {
            width:100%; height:100%;
            position:fixed; top:0; left:0;
            background:#000; display:none;
        }
        
        .image-container img {
            width:100%; height:100%;
            object-fit:contain;
            image-rendering:crisp-edges;
        }
        
        /* é”™è¯¯é¢æ¿ */
        .error-panel {
            position:fixed; top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.95);
            color:#fff; display:none;
            flex-direction:column;
            justify-content:center; align-items:center;
            padding:20px; z-index:200;
        }
        
        .error-content {
            background:rgba(255,255,255,0.05);
            border-radius:12px; padding:25px;
            max-width:350px; width:90%;
            border:1px solid rgba(255,255,255,0.1);
            text-align:center;
        }
        
        .btn {
            display:block; width:100%; padding:14px;
            margin:12px 0; background:#007AFF;
            color:#fff; border:none; border-radius:8px;
            font-size:16px; font-weight:500;
            cursor:pointer; text-align:center;
        }
        
        .btn-alt {
            background:transparent;
            border:2px solid #007AFF;
            color:#007AFF;
        }
        
        .btn:active { opacity:0.8; transform:translateY(1px); }
    </style>
    
    <!-- é¢„è¿æ¥åŠ é€Ÿ -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
</head>
<body>
    <!-- åŠ è½½çŠ¶æ€ -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div id="status">åŠ è½½ä¸­...</div>
    </div>
    
    <!-- å›¾ç‰‡æ˜¾ç¤º -->
    <div class="image-container" id="imageContainer">
        <img id="mainImage" alt="è”šæ¥å¯æœŸé©¬å¹´çª—è´´" crossorigin="anonymous">
    </div>
    
    <!-- é”™è¯¯æç¤º -->
    <div class="error-panel" id="errorPanel">
        <div class="error-content">
            <div style="font-size:42px; margin-bottom:15px;">âš ï¸</div>
            <div style="font-size:18px; font-weight:600; margin-bottom:10px;" id="errorTitle">åŠ è½½å¤±è´¥</div>
            <div style="font-size:14px; color:#aaa; margin-bottom:25px; line-height:1.5;" id="errorMsg">
                ç½‘ç»œè¿æ¥å‡ºç°é—®é¢˜
            </div>
            
            <button class="btn" id="retryBtn">é‡æ–°åŠ è½½</button>
            <button class="btn btn-alt" id="altBtn">å¤‡ç”¨é“¾æ¥</button>
            
            <div style="margin-top:20px; font-size:12px; color:#666; line-height:1.5;">
                å¦‚åå¤å¤±è´¥ï¼Œè¯·å°è¯•ï¼š<br>
                1. åˆ‡æ¢WiFi/4Gç½‘ç»œ<br>
                2. ä½¿ç”¨Chromeæµè§ˆå™¨<br>
                3. å…³é—­VPNæˆ–ä»£ç†
            </div>
        </div>
    </div>

    <script>
        // ==================== æ ¸å¿ƒé…ç½® ====================
        const IMAGES = [
            "é©¬å¹´çª—è´´-02.jpg",
            "é©¬å¹´çª—è´´-03.jpg",
            "é©¬å¹´çª—è´´-04.jpg",
            "é©¬å¹´çª—è´´-05.jpg",
            "é©¬å¹´çª—è´´-06.jpg",
            "é©¬å¹´çª—è´´-07.jpg",
            "é©¬å¹´çª—è´´-08.jpg",
            "é©¬å¹´çª—è´´-09.jpg",
            "é©¬å¹´çª—è´´-10.jpg",
            "é©¬å¹´çª—è´´-11.jpg"
        ];
        
        // ç›´æ¥ä½¿ç”¨CDNé“¾æ¥ï¼ˆä¿®æ­£åçš„æ ¼å¼ï¼‰
        const CDN_BASE_URL = "https://cdn.jsdelivr.net/gh/cfelix888/chunjie/images/";
        
        // ==================== å·¥å…·å‡½æ•° ====================
        function updateStatus(text) {
            document.getElementById('status').textContent = text;
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('imageContainer').style.display = 'none';
            document.getElementById('errorPanel').style.display = 'none';
        }
        
        function showImage() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('imageContainer').style.display = 'block';
            document.getElementById('errorPanel').style.display = 'none';
        }
        
        function showError(title, message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('imageContainer').style.display = 'none';
            document.getElementById('errorPanel').style.display = 'flex';
            
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorMsg').innerHTML = message;
        }
        
        // ==================== å›¾ç‰‡åˆ†é…é€»è¾‘ ====================
        function getAssignedImage() {
            // æ ¹æ®è®¿é—®æ—¶é—´åˆ†é…å›¾ç‰‡ï¼ˆæ¯å°æ—¶å˜åŒ–ï¼‰
            const now = new Date();
            const hourOfDay = now.getHours();
            const dayOfMonth = now.getDate();
            
            // ç®€å•ç®—æ³•ç¡®ä¿ç¨³å®šåˆ†é…
            const seed = (dayOfMonth * 24 + hourOfDay) % IMAGES.length;
            return IMAGES[seed];
        }
        
        // ==================== å›¾ç‰‡åŠ è½½ ====================
        function loadImage() {
            showLoading();
            updateStatus('æ­£åœ¨åŠ è½½å›¾ç‰‡...');
            
            const imageName = getAssignedImage();
            const imageUrl = CDN_BASE_URL + encodeURIComponent(imageName) + '?t=' + Date.now();
            
            console.log('åŠ è½½å›¾ç‰‡:', imageName);
            console.log('å›¾ç‰‡URL:', imageUrl);
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            // è®¾ç½®è¶…æ—¶
            const timeout = setTimeout(() => {
                showError('åŠ è½½è¶…æ—¶', 'å›¾ç‰‡åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•');
            }, 15000);
            
            img.onload = function() {
                clearTimeout(timeout);
                
                if (img.complete && img.naturalWidth > 0) {
                    // å›¾ç‰‡åŠ è½½æˆåŠŸ
                    document.getElementById('mainImage').src = img.src;
                    
                    // ç¡®ä¿å›¾ç‰‡æ¸²æŸ“å®Œæˆåå†æ˜¾ç¤º
                    setTimeout(() => {
                        updateStatus('åŠ è½½å®Œæˆï¼');
                        showImage();
                    }, 300);
                    
                    console.log('âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ');
                } else {
                    showError('å›¾ç‰‡é”™è¯¯', 'å›¾ç‰‡åŠ è½½ä¸å®Œæ•´ï¼Œè¯·é‡è¯•');
                }
            };
            
            img.onerror = function(err) {
                clearTimeout(timeout);
                console.error('âŒ å›¾ç‰‡åŠ è½½å¤±è´¥:', err);
                
                // å°è¯•å¤‡ç”¨æ–¹æ¡ˆ
                if (imageUrl.includes('cdn.jsdelivr.net')) {
                    updateStatus('CDNå¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æº...');
                    setTimeout(tryBackupSource, 1000);
                } else {
                    showError('åŠ è½½å¤±è´¥', 'æ— æ³•åŠ è½½å›¾ç‰‡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                }
            };
            
            // å¼€å§‹åŠ è½½
            img.src = imageUrl;
            
            // å¦‚æœå›¾ç‰‡å·²ç»åœ¨ç¼“å­˜ä¸­
            if (img.complete) {
                img.onload();
            }
        }
        
        // ==================== å¤‡ç”¨æ–¹æ¡ˆ ====================
        function tryBackupSource() {
            // å¦‚æœCDNå¤±è´¥ï¼Œå°è¯•GitHub Pages
            const imageName = getAssignedImage();
            const backupUrl = 'https://cfelix888.github.io/chunjie/images/' + encodeURIComponent(imageName);
            
            updateStatus('å°è¯•å¤‡ç”¨æº...');
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                if (img.complete) {
                    document.getElementById('mainImage').src = img.src;
                    setTimeout(showImage, 300);
                }
            };
            
            img.onerror = function() {
                showError('æ‰€æœ‰æºéƒ½å¤±è´¥', `
                    <div style="text-align: left; line-height: 1.6;">
                    <strong>æ— æ³•åŠ è½½å›¾ç‰‡ï¼Œè¯·å°è¯•ï¼š</strong><br><br>
                    1. æ£€æŸ¥ç½‘ç»œè¿æ¥<br>
                    2. åˆ·æ–°é¡µé¢é‡è¯•<br>
                    3. ä½¿ç”¨ä»¥ä¸‹å¤‡ç”¨é“¾æ¥ï¼š<br>
                    &nbsp;&nbsp;â€¢ <a href="https://cfelix888.github.io/chunjie/" style="color:#007AFF;">GitHubä¸»ç«™</a><br>
                    &nbsp;&nbsp;â€¢ <a href="https://raw.githack.com/cfelix888/chunjie/main/index.html" style="color:#007AFF;">å¤‡ç”¨é•œåƒç«™</a>
                    </div>
                `);
            };
            
            img.src = backupUrl + '?t=' + Date.now();
        }
        
        // ==================== ç”¨æˆ·æ“ä½œ ====================
        function retryLoad() {
            showLoading();
            updateStatus('é‡æ–°åŠ è½½ä¸­...');
            
            // æ¸…é™¤å¯èƒ½çš„ç¼“å­˜
            if (window.caches) {
                caches.keys().then(keys => {
                    keys.forEach(key => caches.delete(key));
                });
            }
            
            // å»¶è¿Ÿé‡è¯•
            setTimeout(loadImage, 800);
        }
        
        function showAlternativeLinks() {
            showError('å¤‡ç”¨è®¿é—®æ–¹å¼', `
                <div style="text-align: left; line-height: 1.6;">
                <strong>å¦‚æœå½“å‰é¡µé¢æ— æ³•åŠ è½½ï¼Œè¯·å°è¯•ï¼š</strong><br><br>
                
                <strong>æ¨èæ–¹æ¡ˆï¼š</strong><br>
                1. <a href="https://cdn.jsdelivr.net/gh/cfelix888/chunjie/index.html" 
                      onclick="event.preventDefault(); window.open(this.href, '_blank');"
                      style="color:#007AFF; text-decoration:none;">
                   ç›´æ¥è®¿é—®CDNé•œåƒ
                   </a><br><br>
                
                <strong>å¤‡é€‰æ–¹æ¡ˆï¼š</strong><br>
                2. <a href="https://cfelix888.github.io/chunjie/"
                      onclick="event.preventDefault(); window.open(this.href, '_blank');"
                      style="color:#007AFF; text-decoration:none;">
                   GitHub Pagesä¸»ç«™
                   </a><br>
                
                3. <a href="https://raw.githack.com/cfelix888/chunjie/main/index.html"
                      onclick="event.preventDefault(); window.open(this.href, '_blank');"
                      style="color:#007AFF; text-decoration:none;">
                   RawGitå¤‡ç”¨ç«™
                   </a><br><br>
                
                <small style="color:#888;">
                <strong>æ“ä½œæç¤ºï¼š</strong><br>
                â€¢ é•¿æŒ‰é“¾æ¥é€‰æ‹©"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€"<br>
                â€¢ å»ºè®®ä½¿ç”¨Chromeæµè§ˆå™¨<br>
                â€¢ ä¸‰æ˜Ÿæ‰‹æœºè¯·å…³é—­"å®‰å…¨WiFi"åŠŸèƒ½
                </small>
                </div>
            `);
        }
        
        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('retryBtn').addEventListener('click', retryLoad);
            document.getElementById('altBtn').addEventListener('click', showAlternativeLinks);
            
            // é˜²æ­¢é¡µé¢æ»šåŠ¨
            document.addEventListener('touchmove', function(e) {
                if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A') {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // ç¦æ­¢ç¼©æ”¾
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            // ç¡®ä¿é¡µé¢ä½ç½®
            window.scrollTo(0, 0);
            
            // å»¶è¿Ÿå¼€å§‹åŠ è½½ï¼Œç¡®ä¿DOMå°±ç»ª
            setTimeout(function() {
                loadImage();
            }, 500);
        });
        
        // é¡µé¢å®Œå…¨åŠ è½½å
        window.addEventListener('load', function() {
            window.scrollTo(0, 0);
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;
        });
        
        // ç›‘å¬ç½‘ç»œçŠ¶æ€
        window.addEventListener('online', function() {
            console.log('âœ… ç½‘ç»œå·²è¿æ¥');
            // å¦‚æœå½“å‰æ˜¯é”™è¯¯çŠ¶æ€ï¼Œè‡ªåŠ¨é‡è¯•
            if (document.getElementById('errorPanel').style.display === 'flex') {
                setTimeout(retryLoad, 1500);
            }
        });
        
        window.addEventListener('offline', function() {
            console.log('âŒ ç½‘ç»œå·²æ–­å¼€');
            if (document.getElementById('loading').style.display === 'flex') {
                showError('ç½‘ç»œæ–­å¼€', 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•');
            }
        });
    </script>
</body>
</html>
